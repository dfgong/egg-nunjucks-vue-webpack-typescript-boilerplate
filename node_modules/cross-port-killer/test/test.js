"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var expect = require("expect.js");
var child_process_1 = require("child_process");
var port_killer_1 = require("../source/port-killer");
var psList = require("ps-list");
describe('Assassin', function () {
    it('should terminate process running on a given port', function (done) {
        var server = child_process_1.spawn('node', [require.resolve('http-server/bin/http-server'), '-p', '7070'], {
            stdio: 'ignore',
            detached: true
        });
        server.unref();
        setTimeout(function () {
            new port_killer_1.Killer(process.platform)
                .kill(7070)
                .then(function (pid) { return expect(server.pid.toString()).to.be(pid.pop()) && psList(); })
                .then(function (data) {
                for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {
                    var pid = data_1[_i].pid;
                    expect(pid).not.to.be(server.pid);
                }
            })
                .then(done);
        }, 500);
    });
});
